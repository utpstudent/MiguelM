@model IEnumerable<parcial3.Models.Articulo>

@{
    ViewBag.Title = "Lista de Artículos";
}

<h2>@ViewBag.Title</h2>

<!-- Formulario de búsqueda -->
@using (Html.BeginForm("Lista", "Articulos", FormMethod.Get))
{
    <div class="form-group">
        <div class="input-group">
            @Html.TextBox("buscar", ViewBag.CurrentFilter as string,
                new { @class = "form-control", placeholder = "Buscar por título, autores o palabras clave..." })
            <span class="input-group-btn">
                <button class="btn btn-primary" type="submit">
                    <i class="glyphicon glyphicon-search"></i> Buscar
                </button>
            </span>
        </div>
    </div>
}

<p>
    @Html.ActionLink("Nuevo Artículo", "Crear", null, new { @class = "btn btn-success" })
    @Html.ActionLink("Ver Estadísticas", "Index", null, new { @class = "btn btn-info" })
</p>

<!-- Tabla de artículos -->
@if (Model.Any())
{
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>@Html.ActionLink("Título", "Lista", new { sortOrder = ViewBag.TituloSortParm })</th>
                    <th>Autores</th>
                    <th>@Html.ActionLink("Estado", "Lista", new { sortOrder = ViewBag.EstadoSortParm })</th>
                    <th>@Html.ActionLink("Fecha Publicación", "Lista", new { sortOrder = ViewBag.FechaSortParm })</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis;">
                            <strong>@Html.DisplayFor(modelItem => item.Titulo)</strong>
                            @if (!string.IsNullOrEmpty(item.DOI))
                            {
                                <br />
                                <small class="text-muted">DOI: @item.DOI</small>
                            }
                        </td>
                        <td style="max-width: 250px;">
                            @Html.DisplayFor(modelItem => item.Autores)
                        </td>
                        <td>
                            @{
                                var estadoClass = "";
                                switch (item.Estado)
                                {
                                    case "Publicado":
                                        estadoClass = "label label-success";
                                        break;
                                    case "Aceptado":
                                        estadoClass = "label label-primary";
                                        break;
                                    case "En revisión":
                                        estadoClass = "label label-warning";
                                        break;
                                    case "Rechazado":
                                        estadoClass = "label label-danger";
                                        break;
                                    default:
                                        estadoClass = "label label-default";
                                        break;
                                }
                            }
                            <span class="@estadoClass">@item.Estado</span>
                        </td>
                        <td>
                            @if (item.FechaPublicacion.HasValue)
                            {
                                @item.FechaPublicacion.Value.ToString("dd/MM/yyyy")
                            }
                            else
                            {
                                <span class="text-muted">No publicada</span>
                            }
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                @Html.ActionLink("Ver", "Detalles", new { id = item.ArticuloID },
                                    new { @class = "btn btn-info", title = "Ver detalles" })
                                @Html.ActionLink("Editar", "Editar", new { id = item.ArticuloID },
                                    new { @class = "btn btn-warning", title = "Editar artículo" })
                                @Html.ActionLink("Eliminar", "Eliminar", new { id = item.ArticuloID },
                                    new { @class = "btn btn-danger", title = "Eliminar artículo" })
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <p class="text-muted">
        Mostrando @Model.Count() artículo(s)
    </p>
}
else
{
    <div class="alert alert-info">
        <strong>No hay artículos registrados.</strong>
        @Html.ActionLink("Crea el primero aquí", "Crear")
    </div>
}